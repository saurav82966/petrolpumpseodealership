<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Details</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        /* Table layout for desktop */
        .user-table {
            margin-top: 20px;
        }

        h4 {
            text-align: center;
        }

        .user-table thead {
            background-color: #0d6efd;
            color: white;
        }

        .user-table th,
        .user-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        /* Card layout for mobile */
        .user-card {
            display: none;
            background-color: white;
            margin-bottom: 20px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .user-card p {
            margin: 5px 0;
            font-size: 16px;
        }

        .user-card span {
            font-weight: 600;
            color: #0d6efd;
        }

        /* Responsive design - show cards on mobile, table on desktop */
        @media (max-width: 768px) {
            .user-table {
                display: none;
            }

            .user-card {
                display: block;
            }
        }
    </style>
</head>

<body>
    <div class="container mt-4">
        <div class="mb-4">
            <h3 class="text-primary">Applicant Details</h3>
            <hr>
        </div>

        <div id="userDetailsTable" class="user-table table-responsive">
            <!-- Table for desktop -->
            <table class="table table-bordered table-hover">
                <thead class="table-primary">
                    <tr>
                        <th>#</th> <!-- Column for serial number -->
                        <th>Applicant Name</th>
                        <th>Email</th>
                        <th>Phone Number</th>
                        <th>Location</th>
                        <th>Pincode</th>
                        <th>District</th>
                        <th>State</th>
                        <th>Company</th>
                        <th>Investment</th>
                        <th>Submitted</th>
                        <th>Action</th> <!-- Column for delete button -->
                    </tr>
                </thead>
                <tbody id="userTableBody">
                    <!-- User rows will be dynamically inserted here -->
                </tbody>
            </table>
        </div>

        <!-- Card view for mobile -->
        <div id="userDetailsCards" class="row">
            <!-- User details as cards will be dynamically shown here on mobile -->
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // Firebase configuration
        var firebaseConfig = {
       apiKey: "AIzaSyDiUXKlL2uFqZTJF80OycHwEU44OMjH5U4",
  authDomain: "inquiry-form-796d0.firebaseapp.com",
  databaseURL: "https://inquiry-form-796d0-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "inquiry-form-796d0",
  storageBucket: "inquiry-form-796d0.firebasestorage.app",
  messagingSenderId: "538374486014",
  appId: "1:538374486014:web:0fd94f1b12a1c9e72f72af"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // Reference to the Firebase database
        var database = firebase.database();

        // Function to calculate detailed time difference (e.g., 2 hours and 5 minutes ago)
        function timeSince(timestamp) {
            var now = new Date();
            var secondsPast = (now.getTime() - timestamp) / 1000;

            if (secondsPast < 60) {
                return `${Math.floor(secondsPast)} seconds ago`;
            } else if (secondsPast < 3600) {
                var minutes = Math.floor(secondsPast / 60);
                return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            } else if (secondsPast < 86400) {
                var hours = Math.floor(secondsPast / 3600);
                var minutes = Math.floor((secondsPast % 3600) / 60);
                return `${hours} hour${hours > 1 ? 's' : ''} ${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            } else {
                var days = Math.floor(secondsPast / 86400);
                return `${days} day${days > 1 ? 's' : ''} ago`;
            }
        }

        // Function to delete a user entry
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this entry?')) {
                var userRef = database.ref('users/' + userId);
                userRef.remove()
                    .then(() => {
                        alert('Entry deleted successfully.');
                    })
                    .catch((error) => {
                        console.error('Error deleting entry:', error);
                    });
            }
        }

        // Function to fetch user data from Firebase in real-time
        function fetchUserData() {
            var usersRef = database.ref('usersdata585');
            usersRef.on('value', function (snapshot) {
                var data = snapshot.val();
                var userTableBody = document.getElementById('userTableBody');
                var userDetailsCards = document.getElementById('userDetailsCards');
                userTableBody.innerHTML = ''; // Clear table content first
                userDetailsCards.innerHTML = ''; // Clear card content first

                // Convert the data object into an array and reverse it
                var keys = Object.keys(data).reverse(); // Reverse to show latest submissions first

                // Initialize serial number based on the total number of users
                var serialNumber = keys.length;

                keys.forEach(function (key) {
                    var user = data[key];
                    var submissionTime = timeSince(user.timestamp);

                    // Create a table row for each user
                    var tableRow = document.createElement('tr');
                    tableRow.innerHTML = `
                        <td>${serialNumber}</td> <!-- Add serial number in descending order -->
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.number}</td>
                        <td>${user.location}</td>
                        <td>${user.pincode}</td>
                        <td>${user.district}</td>
                        <td>${user.state}</td>
                        <td>${user.company}</td>
                        <td>${user.investment}</td>
                        <td>${submissionTime}</td> <!-- Display submission time -->
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteUser('${key}')">Delete</button>
                        </td> <!-- Delete button -->
                    `;
                    userTableBody.appendChild(tableRow);

                    // Create a card for each user (for mobile view)
                    var userCard = document.createElement('div');
                    userCard.className = 'col-md-6 col-lg-4 user-card';

                    userCard.innerHTML = `
                    <h4>Submitted: ${submissionTime}</h4>
                        <p><span>Serial Number:</span> ${serialNumber}</p> <!-- Add serial number in descending order -->
                        <p><span>Applicant Name:</span> ${user.name}</p>
                        <p><span>Email:</span> ${user.email}</p>
                        <p><span>Phone Number:</span> ${user.number}</p>
                        <p><span>Location:</span> ${user.location}</p>
                        <p><span>Pincode:</span> ${user.pincode}</p>
                        <p><span>District:</span> ${user.district}</p>
                        <p><span>State:</span> ${user.state}</p>
                        <p><span>Company:</span> ${user.company}</p>
                        <p><span>Investment:</span> ${user.investment}</p>
                        <button class="btn btn-danger btn-sm mt-2" onclick="deleteUser('${key}')">Delete</button> <!-- Delete button in card view -->
                    `;
                    userDetailsCards.appendChild(userCard);

                    // Decrement serial number for the next user
                    serialNumber--;
                });
            });
        }

        // Call fetchUserData to initialize the listener
        fetchUserData();
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
</body>

</html>